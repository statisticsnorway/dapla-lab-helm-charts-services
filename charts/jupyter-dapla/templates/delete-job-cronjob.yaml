{{ if .Values.deleteJob.enabled }}
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ include "library-chart.fullname" . }}
spec:
  schedule: "* {{ .Values.deleteJob.hourAtDayUTC }} * * *"
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: {{ include "library-chart.serviceAccountName" . }}-delete
          containers:
            - name: delete-job
              image: europe-north1-docker.pkg.dev/artifact-registry-5n/dapla-lab-docker/helm-cli:main
              imagePullPolicy: IfNotPresent
              command:
                - helm
              args:
                - delete
                - {{ .Release.Name }}
          restartPolicy: OnFailure
{{- end }}