{{- if .Values.security.oauth2.enabled }}
# Should be moved to library-charts
apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-client-config-{{ include "library-chart.fullname" . }}
data:
  oauth2-proxy-client-config.yaml: |-
      provider = "google"

      # This will restrict login to accounts with email address in the
      # configured domain.
      email_domains = "*"

      # Request "standard" scopes from Keycloak.
      scope = "openid email profile"

      # The <addr>:<port> to listen on for HTTP/HTTPS clients.
      http_address = "0.0.0.0:4180"

      # Url(s) of the upstream endpoint. If multiple, routing is based on path.
      # Does not work with "hostname" based ruting.
      upstreams = ["http://127.0.0.1:{{ .Values.networking.service.port}}"]

      ## Headers

      # Passing of OIDC ID-Token to upstream in a Authorization Bearer header.
      pass_authorization_header = true

      # Passing the request Host Header to upstream. If set to "false" the
      # host of the upstream will be used.
      pass_host_header = true

      # Passing HTTP Basic Auth, X-Forwarded-User and X-Forwarded-Email
      # information to upstream.
      pass_basic_auth = false

      # Passing Oauth access_token to upstream via X-Forwarded-Access-Token
      # header.
      pass_access_token = false

      ## Cookie settings

      # Base name of cookies to store tokens.
      cookie_name = "oauth2_proxy"

      # Generate a random encryption key for encrypting the cookies (AES) to ensures
      # that only "this" client can read the cookies containing the tokens.
      cookie_secret = ""

      # An active session can be max 8 hours long.
      cookie_expire = "8h"

      # Refresh cookies and tokens after max 10 minutes. This value should be larger
      # than the expiry of the access token and probably less than "cookie_expire".
      cookie_refresh = "10m"

      # HTTPS only cookies.
      cookie_secure = true

      # Not available to Javascript.
      cookie_httponly = true

      ## skip SSL checking for HTTPS requests
      ssl_insecure_skip_verify = true

---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: "true"
  name: oauth2-proxy-{{ include "library-chart.fullname" . }}
spec:
  encryptedData:
    client-id: AgAQd1RH1KMJkanWuhjj0J198S1EIuOLwJdM7wRc1io3aNIM8gaGVVGYq0+Wxg0nfbjz37i8gv+J0ylgNG9jd7z6WRDbOKvDledHE38kcWgvV5d4FiT1FDXYU3b6cWXSHC3hayAhsqOcT+t+1skO0xmfUZK/Y483KiEyNidNOfaiAHbPLbcAWyX3jVXIRLXk/9PLwfyMbOA2G0cBlOGvQeMmbxa9GWSDTRzhtclikcri7Sfnn+4XeXxIyoKaBjOW6Iu7nsZGhxuYVp5leBQdShYfSwG7WXPyzzEQMRHn68vzR6KVA+VAyDDh/v/LSYlOwGMon2LxJqDwIJK6MvCF6IEXIYeWVVaOOhN+/bgaix1YQ6uwRZ7GpSi7q2/lr/eAG+Ep3gJQGTChYxQuw3Ydw37d7eg3nxDh7RYiyHkE5ZQkC6Uid7yySWAWa2N0OFO6ekgKs3+pJWGbnmjYYuXKUJigz7dFASoPvvno3qnkR79MWds6C2NZbUoy+S3GfZyIaj3n/iOwea/m3SV2rpBh7bla6cMplZMGEex2uKu4uQFIMmMtNU3bmR7KyNCD2G+/k5pXsC07fTRJNGSZjalPTReas/1Dzn9Omj/nltO3C60hVu/pMbSSz9YVGZIXEjGfcyMfNuFP4ul1tUZ4zYoDHtl9uPHneDfDg6nLmS4tjoCUYlQTW9HAyJWO1qedE2FlvBKiamZUJrzg3qIkdcN6H3CLmWvUSoIjUrdy0UAotWneXkfs8Qs=
    client-secret: AgBBeIly0LYdsHJ4eNl7Ofqk4TbmRW2PXTSLGWYRW2VM97xU2cXlnipS3SZlej/0x+Kdp9fx3jx0cPQ2kFRLngHtSjP4oGEb7ZvnD7/AKvXBjtSYKF7crntx0+WfumIvKPmEBWd51cmufW4zwrNCmGWvuiWcPBSEDiF5g6RK520av9cY+LBs6PBmKpZiqaQwsRcRk4J4jseRCQViqX4aq4pabhwtjsVxTV6xywr5i1tWcqcAtOGp8CO9TAIvg7PsqWP5bmwh0qSDj489kpbhL5Etcmq4vuhc9GOqFufE5NXUuT0B8PYAjnOdu8WE3WK+p72Z7kuA3elCICPKJclWgVGQJfG3lOiYl1DxdWx4wDSU2h/r+DU6+0oUWnZUfVwi5K6M1xoolRVXPlY8Q01pm6pkCw27Nf1YlGos/bOSMfn0WAYze+oKX5bYhQuAEN1oceshIkgjU2YwLQTa26UBHLNhfceua3/iWGt39RzkWhP1glmSdKbPEIUV5Vkm9biIHpi+vBADcLXW0+OP0HD/PQ7dqJhNgjlU6q2fcHm4CW4/5yf9au+AGZ8sGnFhfKurx0mbDGBhtQZnMgrK7qTWhq4rO6b3QMixq0a0xgZLHN9tXsOWGeDiGJ42/Rb0madDi1pcBNjpOYlSbYfH47kZXcH+vnmcRkVgAByq15PopwwRO57RMN0TPtUq1/kfp7njar8y/LJabpgvtO0Qxe72EkBo1wOwlaf1emDNIvOytnTKp5VTt7DXiGY/
    cookie-secret: AgAbyJ4VQrVxKcO2FmpqQXe3cB8cI9Moq7Ae0xqrfb4XNTBgOPSJvSnjE5CkCVRaFlBBXLRLmqEXaDrgqTNIxrkt0gFHt6JPWMaNrSZdKqe0JAfhmjpP8NandJgj92fzR9DbtlbAXbvcz1uXUNJmwZp+A2IDc9NwGkz7Dvm1kMVQdlWnwBQGqLNnawNwU2z1UWBvxcNLikALMIHD4X9ToRU1JKpBM6Rmij4Mjmz5TuypE/1Y3SZNDURvtJx+xsy76Hz9Xaki7Gm4xesYt4KDZjopG7HRhyD8GfWpYWpQ1qP0nTltp/MpqsVuLNvHh5J8blsdGkJqBrgbhlV4h2DGO+vR8MJbhjpERGLTZtdwzj3t6a/E95XTLag6Sga1AkJW0P17zUvm94g02BuY5Io26A8lXjmK5e4C/LpDdWq9a5IIjbbvhdOmTIGl5x07zQDobgndRz5aj5UGccBCLgIqOTBdxwq8w/vaVWqkiABg1IyavumNpILU0v/sd+CwHIfAtMIwgHNucVNc6m4VejgmeWmTp+AkqfhMdstUVejaVCYJVBULe5EAUj2xFlSoYAv5fbJYbcGoRmSX9Zy3B96Ki1a9aQpGDTUecKoPCu1wdIbJC1IXwG4uHukcSpni22W1HtMvAfk4a/67mSMbxW0pW3nVEe2H0+tx5+LSlUaD7wdPVvMDnTelgOX7RWEhz7U0XtWYIEdMBcBdy0ZXjzPi/vrAEiQP4xU5nXfWcg/LfcHqQh1KlxSRAakDYrVo2w==
  template:
    data: null
    metadata:
      annotations:
        sealedsecrets.bitnami.com/cluster-wide: "true"
      creationTimestamp: null
      name: oauth2-proxy

{{- end }}